import torch
import torch.nn as nn
import torch.optim as optim
from torch.utils.data import random_split, Dataset, DataLoader
import torchvision.transforms as transforms
from torchvision import datasets
from torchvision.datasets import ImageFolder
from torchmetrics import Accuracy
from torch.optim.lr_scheduler import StepLR
from tqdm import tqdm

import matplotlib.pyplot as plt
import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
import os
from PIL import Image

# Key changes: change data_dir path

# ------------------------------------------------------------------------------------------------------------------
# Define model
from NEW_models import CNN_9, CNN_16, CNN_19

# transform and init data
from NEW_dataloader import MathSymbolDataset

transform = transforms.Compose([
    transforms.Grayscale(num_output_channels=1),  # Convert to grayscale
    transforms.ToTensor(),
    transforms.Normalize(mean=(0.5,), std=(0.5,)) # subtract 0.5 and then divide 0.5 (z-score)
])


train_dataset = MathSymbolDataset(data_dir='data/extracted_images_new', mode = 'train', transform=transform, seed=21)
train_size = int(0.9 * len(train_dataset)) # split into train and val set
val_size = len(train_dataset) - train_size
new_train_dataset, val_dataset = random_split(dataset=train_dataset, lengths=[train_size, val_size])
test_dataset = MathSymbolDataset(data_dir='data/extracted_images_new', mode = 'test', transform=transform, seed=21)

# ------------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------------
# Train and val loops
def main(num_epochs, experimentNum, use_model, use_dataset_train, use_dataset_val, use_dataset_test, num_classes, loadFromSaved, test_loop, LR):

    train_loader = DataLoader(use_dataset_train, batch_size=32, shuffle=True, num_workers=6) # num_workers must be with if name
    val_loader = DataLoader(use_dataset_val, batch_size=32, shuffle=False, num_workers=1)
    test_loader = DataLoader(use_dataset_test, batch_size=32, shuffle=False, num_workers=1)

    # About 270,000 elements in new_train_dataset
    # Each element is a length two tuple containing 1: a 1x45x45 tensor and 2: the label number

    # start loop -----------------------------------------------------------------------------------------------------
    num_epochs = num_epochs
    train_losses, val_losses, train_accs, val_accs = [], [], [], []
    
    model = use_model
    criterion = nn.CrossEntropyLoss() # loss function
    optimizer = optim.Adam(model.parameters(), lr = LR)
    scheduler = StepLR(optimizer, step_size = 10, gamma = 0.8)
    accuracy = Accuracy(task='multiclass', num_classes=num_classes)

    device = 'cuda' if torch.cuda.is_available() else 'cpu'
    accuracy = accuracy.to(device)
    model = model.to(device)

    if loadFromSaved is not None:
        model.load_state_dict(torch.load(loadFromSaved, map_location=device, weights_only=True))
    
    for epoch in range(num_epochs):
        model.train()
        running_loss, running_acc = 0.0, 0.0
        accuracy.reset()
        
        for images, labels in tqdm(train_loader, desc=f"Epoch {epoch+1}: training loop"):
            images = images.to(device)
            labels = labels.to(device)

            outputs = model(images) # forward pass
            loss = criterion(outputs, labels) 

            running_loss += loss.item() * images.size(0) # loss tensor times batch size
            running_acc += accuracy(outputs, labels)

            loss.backward()
            optimizer.step()
            optimizer.zero_grad()
            
        train_acc = running_acc / len(train_loader.dataset) * 32 * 100
        train_accs.append(train_acc)
        train_loss = running_loss / len(train_loader.dataset) 
        train_losses.append(train_loss)

        # valid phase
        model.eval()
        running_loss = 0.0
        running_acc = 0.0
        with torch.no_grad():
            for images, labels in tqdm(val_loader, desc=f"Epoch {epoch+1}: val loop"):
                images = images.to(device)
                labels = labels.to(device)
                outputs = model(images)
                loss = criterion(outputs, labels)
                running_loss += loss.item() * images.size(0)
                running_acc += accuracy(outputs, labels)

            val_loss = running_loss / len(val_loader.dataset) 
            val_losses.append(val_loss)
            val_acc = running_acc / len(val_loader.dataset) * 32 * 100
            val_accs.append(val_acc)

    

        scheduler.step()

        if (epoch+1) % 5 == 0:
            print(f"Epoch {epoch+1}/{num_epochs} - Train loss: {train_loss} train acc: {train_acc}, val loss: {val_loss}, val acc: {val_acc}")
            torch.save(model.state_dict(), f'NEW_save_states/CNNmodel{experimentNum}Epoch{epoch+1}.pt')  # Save the trained model

    torch.save(model.state_dict(), f'NEW_save_states/CNNmodel{experimentNum}Epoch{epoch+1}.pt')  # Save the trained model

    plt.plot(np.arange(num_epochs), list(train_losses))
    plt.xlabel('Epochs')
    plt.ylabel('Loss')
    plt.title('Loss over time')
    plt.show()

    if test_loop:
        model.eval()
        running_acc = 0.0
        for images, labels in tqdm(test_loader, desc="testing"):
            images = images.to(device)
            labels = labels.to(device)
            outputs = model(images)
            running_acc += accuracy(outputs, images)
        
        test_loss = running_acc / len(test_loader.dataset) * 32 * 100
        print(f"TEST LOSS: {test_loss}")

if __name__ == '__main__':
    main(num_epochs = 120, 
         experimentNum = 19,
         use_model = CNN_19(),
         use_dataset_train = new_train_dataset,
         use_dataset_val = val_dataset,
         use_dataset_test = test_dataset,
         num_classes = 72,
         loadFromSaved = None,
         test_loop = True,
         LR = 0.001)


# Duplicate of everything with NEW_ prefix, start with CNN_9 and adjust

# Experiment 15: 0.0035 LR from 0.003, same as CNN_9 but just increase LR
# Epoch 40 - Train loss: 0.06470691475075424 train acc: 98.91757202148438, val loss: 0.09432324577125029, val acc: 98.84830474853516

# Experiment 16, changed test and train seed to 21, dropout last FC layer, learning rate to 0.0025 ***CHANGE TO CNN_16
# peaked at 97.4 percent acc

# Experiment 17, same as before but decrease LR to 0.001 and 60 epochs (uses CNN_16)
# Epoch 45/60 - Train loss: 1.7970874412371167 train acc: 54.42210006713867, val loss: 0.022417195288928885, val acc: 99.59793090820312'''

# Experiment 18, same but decrease LR to 0.0007
'''
Epoch 40/120 - Train loss: 1.796863111263619 train acc: 54.47850799560547, val loss: 0.020148418561522927, val acc: 99.67630004882812
Epoch 50/120 - Train loss: 1.8003004343653521 train acc: 54.43686294555664, val loss: 0.021955023554910174, val acc: 99.70014953613281
Epoch 70/120 - Train loss: 1.7920134145669913 train acc: 54.63449478149414, val loss: 0.018674188788209548, val acc: 99.8364486694336
Epoch 90/120 - Train loss: 1.790238317859528 train acc: 54.67576217651367, val loss: 0.01661837912969268, val acc: 99.8841552734375
Epoch 105/120 - Train loss: 1.7832430657807232 train acc: 54.809791564941406, val loss: 0.01611637465686386, val acc: 99.89778137207031
Epoch 115/120 - Train loss: 1.7967954847319871 train acc: 54.458065032958984, val loss: 0.016530913844644706, val acc: 99.89437103271484
'''

# Experiment 19, increase LR to 0.001 and decrease dropout to p=0.2. *** Change to CNN_19

'''Epoch 1: training loop: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [02:18<00:00, 59.69it/s]
Epoch 1: val loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:31<00:00, 29.17it/s]
Epoch 2: training loop: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [02:02<00:00, 67.30it/s]
Epoch 2: val loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:34<00:00, 26.84it/s]
Epoch 3: training loop: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [02:06<00:00, 65.33it/s]
Epoch 3: val loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:32<00:00, 28.53it/s]
Epoch 4: training loop: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [02:02<00:00, 67.61it/s]
Epoch 4: val loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:30<00:00, 30.03it/s]
Epoch 5: training loop: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:59<00:00, 68.89it/s]
Epoch 5: val loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.56it/s]
Epoch 5/120 - Train loss: 0.7698675237079768 train acc: 80.33415985107422, val loss: 0.055143443943637974, val acc: 98.5859375
Epoch 6: training loop: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.72it/s]
Epoch 6: val loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.63it/s]
Epoch 7: training loop: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.65it/s]
Epoch 7: val loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.29it/s]
Epoch 8: training loop: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.56it/s]
Epoch 8: val loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.41it/s]
Epoch 9: training loop: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.58it/s]
Epoch 9: val loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.56it/s]
Epoch 10: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.73it/s]
Epoch 10: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.40it/s]
Epoch 10/120 - Train loss: 0.7586527293839266 train acc: 80.73737335205078, val loss: 0.039878723752218785, val acc: 98.96075439453125
Epoch 11: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.71it/s]
Epoch 11: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.91it/s]
Epoch 12: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.69it/s]
Epoch 12: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.34it/s]
Epoch 13: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.66it/s]
Epoch 13: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.13it/s]
Epoch 14: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.50it/s]
Epoch 14: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.55it/s]
Epoch 15: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.55it/s]
Epoch 15: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.79it/s]
Epoch 15/120 - Train loss: 0.7374283081284928 train acc: 81.27385711669922, val loss: 0.03743168568060653, val acc: 99.13452911376953
Epoch 16: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.43it/s]
Epoch 16: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.75it/s]
Epoch 17: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.38it/s] 
Epoch 17: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.29it/s] 
Epoch 18: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.49it/s] 
Epoch 18: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.56it/s] 
Epoch 19: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.59it/s] 
Epoch 19: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.10it/s] 
Epoch 20: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.60it/s] 
Epoch 20: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.57it/s] 
Epoch 20/120 - Train loss: 0.7350446663058134 train acc: 81.44271087646484, val loss: 0.04082748716876194, val acc: 99.2469711303711
Epoch 21: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.68it/s]
Epoch 21: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.17it/s] 
Epoch 22: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.49it/s] 
Epoch 22: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.62it/s] 
Epoch 23: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.61it/s] 
Epoch 23: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.50it/s] 
Epoch 24: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.42it/s] 
Epoch 24: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.57it/s] 
Epoch 25: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.55it/s] 
Epoch 25: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.39it/s] 
Epoch 25/120 - Train loss: 0.7348870031831432 train acc: 81.39197540283203, val loss: 0.03599982066018604, val acc: 99.451416015625
Epoch 26: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.48it/s]
Epoch 26: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.37it/s] 
Epoch 27: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [02:09<00:00, 63.86it/s] 
Epoch 27: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:22<00:00, 41.32it/s] 
Epoch 28: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.53it/s] 
Epoch 28: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.51it/s] 
Epoch 29: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.55it/s] 
Epoch 29: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.75it/s] 
Epoch 30: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.69it/s] 
Epoch 30: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.56it/s] 
Epoch 30/120 - Train loss: 0.7287063268148788 train acc: 81.57711791992188, val loss: 0.05057302341744006, val acc: 99.50592803955078
Epoch 31: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.59it/s]
Epoch 31: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.88it/s] 
Epoch 32: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.57it/s] 
Epoch 32: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.33it/s] 
Epoch 33: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.38it/s] 
Epoch 33: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.25it/s] 
Epoch 34: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.61it/s] 
Epoch 34: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.48it/s] 
Epoch 35: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.65it/s] 
Epoch 35: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.10it/s] 
Epoch 35/120 - Train loss: 0.7279050249070843 train acc: 81.57559967041016, val loss: 0.03539760755252864, val acc: 99.68312072753906
Epoch 36: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.55it/s]
Epoch 36: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.41it/s] 
Epoch 37: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.64it/s] 
Epoch 37: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.32it/s] 
Epoch 38: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.59it/s] 
Epoch 38: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.46it/s] 
Epoch 39: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.37it/s] 
Epoch 39: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.11it/s] 
Epoch 40: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.37it/s] 
Epoch 40: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.41it/s] 
Epoch 40/120 - Train loss: 0.7237641023978696 train acc: 81.68766784667969, val loss: 0.03161045874095144, val acc: 99.67630004882812
Epoch 41: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.39it/s]
Epoch 41: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.42it/s]
Epoch 42: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.57it/s] 
Epoch 42: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.60it/s]
Epoch 43: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.46it/s] 
Epoch 43: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.45it/s] 
Epoch 44: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.52it/s] 
Epoch 44: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.42it/s] 
Epoch 45: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.43it/s] 
Epoch 45: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.68it/s] 
Epoch 45/120 - Train loss: 0.7296620580585721 train acc: 81.5377426147461, val loss: 0.03091347342870148, val acc: 99.71378326416016
Epoch 46: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.45it/s]
Epoch 46: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.18it/s]
Epoch 47: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.54it/s] 
Epoch 47: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.17it/s] 
Epoch 48: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.38it/s] 
Epoch 48: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.19it/s] 
Epoch 49: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.44it/s] 
Epoch 49: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.32it/s] 
Epoch 50: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.40it/s] 
Epoch 50: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.24it/s] 
Epoch 50/120 - Train loss: 0.7264944429452854 train acc: 81.63693237304688, val loss: 0.03346620736630914, val acc: 99.79215240478516
Epoch 51: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.48it/s]
Epoch 51: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.41it/s] 
Epoch 52: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [02:00<00:00, 68.24it/s] 
Epoch 52: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:22<00:00, 41.42it/s] 
Epoch 53: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:59<00:00, 69.00it/s] 
Epoch 53: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:19<00:00, 47.83it/s] 
Epoch 54: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [02:04<00:00, 66.32it/s] 
Epoch 54: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:19<00:00, 46.71it/s] 
Epoch 55: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.39it/s] 
Epoch 55: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.72it/s] 
Epoch 55/120 - Train loss: 0.7186999298934525 train acc: 81.79480743408203, val loss: 0.04076681457441326, val acc: 99.72740936279297
Epoch 56: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:59<00:00, 69.27it/s]
Epoch 56: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.32it/s] 
Epoch 57: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.41it/s] 
Epoch 57: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.29it/s] 
Epoch 58: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.49it/s] 
Epoch 58: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.31it/s] 
Epoch 59: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.47it/s] 
Epoch 59: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.05it/s] 
Epoch 60: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.47it/s] 
Epoch 60: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.32it/s] 
Epoch 60/120 - Train loss: 0.715689688275313 train acc: 81.84744262695312, val loss: 0.0389006942676502, val acc: 99.80237579345703
Epoch 61: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.57it/s]
Epoch 61: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.16it/s] 
Epoch 62: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.39it/s] 
Epoch 62: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.53it/s] 
Epoch 63: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:59<00:00, 69.14it/s] 
Epoch 63: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:19<00:00, 48.28it/s] 
Epoch 64: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [02:01<00:00, 67.73it/s] 
Epoch 64: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.38it/s] 
Epoch 65: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.45it/s] 
Epoch 65: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 48.91it/s] 
Epoch 65/120 - Train loss: 0.7169407898613114 train acc: 81.83721923828125, val loss: 0.04162650536637014, val acc: 99.85689544677734
Epoch 66: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.52it/s]
Epoch 66: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.52it/s] 
Epoch 67: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.38it/s] 
Epoch 67: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.16it/s] 
Epoch 68: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.59it/s] 
Epoch 68: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.58it/s] 
Epoch 69: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.37it/s] 
Epoch 69: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.43it/s]
Epoch 70: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.41it/s] 
Epoch 70: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.28it/s] 
Epoch 70/120 - Train loss: 0.7153182888034828 train acc: 81.88302612304688, val loss: 0.03755194554882695, val acc: 99.87052154541016
Epoch 71: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.46it/s]
Epoch 71: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.21it/s] 
Epoch 72: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:59<00:00, 69.29it/s] 
Epoch 72: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.46it/s] 
Epoch 73: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.46it/s] 
Epoch 73: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.20it/s] 
Epoch 74: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.47it/s] 
Epoch 74: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.50it/s] 
Epoch 75: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.45it/s] 
Epoch 75: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.47it/s] 
Epoch 75/120 - Train loss: 0.7157957389279817 train acc: 81.86940002441406, val loss: 0.04080612302126411, val acc: 99.8500747680664
Epoch 76: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.41it/s]
Epoch 76: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 48.94it/s] 
Epoch 77: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.54it/s] 
Epoch 77: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.32it/s] 
Epoch 78: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.54it/s] 
Epoch 78: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.20it/s] 
Epoch 79: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.46it/s] 
Epoch 79: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 48.73it/s] 
Epoch 80: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [02:01<00:00, 68.00it/s] 
Epoch 80: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.20it/s] 
Epoch 80/120 - Train loss: 0.7129357677567598 train acc: 81.95306396484375, val loss: 0.03691062001210219, val acc: 99.85348510742188
Epoch 81: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [02:01<00:00, 67.95it/s]
Epoch 81: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:19<00:00, 46.08it/s] 
Epoch 82: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:59<00:00, 69.35it/s] 
Epoch 82: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.19it/s] 
Epoch 83: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.58it/s] 
Epoch 83: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.32it/s] 
Epoch 84: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.43it/s] 
Epoch 84: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.14it/s] 
Epoch 85: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.41it/s] 
Epoch 85: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.42it/s] 
Epoch 85/120 - Train loss: 0.7194462625906937 train acc: 81.78194427490234, val loss: 0.024935387839693044, val acc: 99.90459442138672
Epoch 86: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.45it/s]
Epoch 86: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.38it/s] 
Epoch 87: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.49it/s] 
Epoch 87: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.42it/s] 
Epoch 88: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.43it/s] 
Epoch 88: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.09it/s] 
Epoch 89: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:59<00:00, 69.30it/s] 
Epoch 89: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.03it/s] 
Epoch 90: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.43it/s] 
Epoch 90: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.41it/s] 
Epoch 90/120 - Train loss: 0.716269019311232 train acc: 81.86637115478516, val loss: 0.034998249082753445, val acc: 99.90800476074219
Epoch 91: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.45it/s]
Epoch 91: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.52it/s] 
Epoch 92: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.62it/s] 
Epoch 92: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 48.96it/s] 
Epoch 93: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.45it/s] 
Epoch 93: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.38it/s] 
Epoch 94: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.47it/s] 
Epoch 94: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.24it/s]
Epoch 95: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:59<00:00, 69.32it/s] 
Epoch 95: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.24it/s] 
Epoch 95/120 - Train loss: 0.7169919920367526 train acc: 81.83191680908203, val loss: 0.034656451603172635, val acc: 99.91822814941406
Epoch 96: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:59<00:00, 69.30it/s]
Epoch 96: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.24it/s] 
Epoch 97: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:59<00:00, 69.25it/s] 
Epoch 97: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.32it/s] 
Epoch 98: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.44it/s] 
Epoch 98: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.13it/s] 
Epoch 99: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.64it/s] 
Epoch 99: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.39it/s] 
Epoch 100: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.39it/s] 
Epoch 100: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.87it/s] 
Epoch 100/120 - Train loss: 0.722978984740311 train acc: 81.68577575683594, val loss: 0.03668767113925428, val acc: 99.8841552734375
Epoch 101: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.53it/s]
Epoch 101: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.39it/s] 
Epoch 102: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:59<00:00, 69.28it/s] 
Epoch 102: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.38it/s] 
Epoch 103: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:59<00:00, 69.30it/s] 
Epoch 103: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.01it/s] 
Epoch 104: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:59<00:00, 69.22it/s] 
Epoch 104: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.18it/s] 
Epoch 105: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:59<00:00, 69.25it/s] 
Epoch 105: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.42it/s] 
Epoch 105/120 - Train loss: 0.7138236155555874 train acc: 81.93489837646484, val loss: 0.029557991022615936, val acc: 99.9148178100586
Epoch 106: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.44it/s]
Epoch 106: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 48.90it/s] 
Epoch 107: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [02:02<00:00, 67.29it/s] 
Epoch 107: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 48.94it/s] 
Epoch 108: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [02:00<00:00, 68.48it/s] 
Epoch 108: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:20<00:00, 44.63it/s] 
Epoch 109: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.37it/s] 
Epoch 109: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.60it/s] 
Epoch 110: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.48it/s] 
Epoch 110: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.34it/s] 
Epoch 110/120 - Train loss: 0.7161909691200157 train acc: 81.8682632446289, val loss: 0.03164955487161701, val acc: 99.88755798339844
Epoch 111: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.45it/s]
Epoch 111: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.33it/s] 
Epoch 112: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:59<00:00, 69.27it/s] 
Epoch 112: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.55it/s] 
Epoch 113: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:59<00:00, 69.34it/s] 
Epoch 113: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.58it/s] 
Epoch 114: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.39it/s] 
Epoch 114: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.30it/s] 
Epoch 115: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.36it/s] 
Epoch 115: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.47it/s] 
Epoch 115/120 - Train loss: 0.7196000040951311 train acc: 81.734619140625, val loss: 0.027915199767742777, val acc: 99.90459442138672
Epoch 116: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.39it/s]
Epoch 116: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.26it/s] 
Epoch 117: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.43it/s] 
Epoch 117: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 48.97it/s] 
Epoch 118: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.62it/s] 
Epoch 118: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.30it/s] 
Epoch 119: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.55it/s] 
Epoch 119: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.20it/s] 
Epoch 120: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8254/8254 [01:58<00:00, 69.45it/s] 
Epoch 120: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 918/918 [00:18<00:00, 49.50it/s] 
Epoch 120/120 - Train loss: 0.7116218538648261 train acc: 81.94966125488281, val loss: 0.03397254486860065, val acc: 99.9148178100586'''