import torch
import torch.nn as nn
import torch.optim as optim
from torch.utils.data import random_split, Dataset, DataLoader
import torchvision.transforms as transforms
from torchvision import datasets
from torchvision.datasets import ImageFolder
from torchmetrics import Accuracy
from torch.optim.lr_scheduler import StepLR
from tqdm import tqdm

import matplotlib.pyplot as plt
import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
import os
from PIL import Image


# ------------------------------------------------------------------------------------------------------------------
# Define model
from models import CNN13, CNN14, VamsiNN

# transform and init data
from dataloader import MathSymbolDataset

transform = transforms.Compose([
    transforms.Grayscale(num_output_channels=1),  # Convert to grayscale
    transforms.ToTensor(),
    transforms.Normalize(mean=(0.5,), std=(0.5,)) # subtract 0.5 and then divide 0.5 (z-score)
])

MNIST_transform = transforms.Compose([
    transforms.Grayscale(num_output_channels=1),
    transforms.Resize((28,28)),
    transforms.ToTensor()
])

train_dataset = MathSymbolDataset(data_dir='data/extracted_images', mode = 'train', transform=transform, seed=42)
train_size = int(0.9 * len(train_dataset)) # split into train and val set
val_size = len(train_dataset) - train_size
new_train_dataset, val_dataset = random_split(dataset=train_dataset, lengths=[train_size, val_size])
test_dataset = MathSymbolDataset(data_dir='data/extracted_images', mode = 'test', transform=transform, seed=42)

MNIST_dataset = datasets.MNIST(root='./data', train=True, transform=MNIST_transform, download=True)
MNIST_dataset_test = datasets.MNIST(root='./data', train=False, transform=MNIST_transform, download=True)

# ------------------------------------------------------------------------------------------------------------------
# ------------------------------------------------------------------------------------------------------------------
# Train and val loops
def main(num_epochs, experimentNum, use_model, use_dataset_train, use_dataset_val, use_dataset_test, num_classes, loadFromSaved, test_loop):

    train_loader = DataLoader(use_dataset_train, batch_size=32, shuffle=True, num_workers=5) # num_workers must be with if name
    val_loader = DataLoader(use_dataset_val, batch_size=32, shuffle=False, num_workers=1)
    test_loader = DataLoader(use_dataset_test, batch_size=32, shuffle=False, num_workers=1)

    # About 270,000 elements in new_train_dataset
    # Each element is a length two tuple containing 1: a 1x45x45 tensor and 2: the label number

    # start loop -----------------------------------------------------------------------------------------------------
    num_epochs = num_epochs
    train_losses, val_losses, train_accs, val_accs = [], [], [], []
    
    model = use_model
    criterion = nn.CrossEntropyLoss() # loss function
    optimizer = optim.Adam(model.parameters(), lr = 0.0015)
    scheduler = StepLR(optimizer, step_size = 10, gamma = 0.8)
    accuracy = Accuracy(task='multiclass', num_classes=num_classes)

    device = 'cuda' if torch.cuda.is_available() else 'cpu'
    accuracy = accuracy.to(device)
    model = model.to(device)

    if loadFromSaved is not None:
        model.load_state_dict(torch.load(loadFromSaved, map_location=device, weights_only=True))
    
    for epoch in range(num_epochs):
        model.train()
        running_loss, running_acc = 0.0, 0.0
        accuracy.reset()
        
        for images, labels in tqdm(train_loader, desc=f"Epoch {epoch+1}: training loop"):
            images = images.to(device)
            labels = labels.to(device)

            outputs = model(images) # forward pass
            loss = criterion(outputs, labels) 

            running_loss += loss.item() * images.size(0) # loss tensor times batch size
            running_acc += accuracy(outputs, labels)

            loss.backward()
            optimizer.step()
            optimizer.zero_grad()
            
        train_acc = running_acc / len(train_loader.dataset) * 32 * 100
        train_accs.append(train_acc)
        train_loss = running_loss / len(train_loader.dataset) 
        train_losses.append(train_loss)

        # valid phase
        model.eval()
        running_loss = 0.0
        running_acc = 0.0
        with torch.no_grad():
            for images, labels in tqdm(val_loader, desc=f"Epoch {epoch+1}: val loop"):
                images = images.to(device)
                labels = labels.to(device)
                outputs = model(images)
                loss = criterion(outputs, labels)
                running_loss += loss.item() * images.size(0)
                running_acc += accuracy(outputs, labels)

            val_loss = running_loss / len(val_loader.dataset) 
            val_losses.append(val_loss)
            val_acc = running_acc / len(val_loader.dataset) * 32 * 100
            val_accs.append(val_acc)

        print(f"Epoch {epoch+1}/{num_epochs} - Train loss: {train_loss} train acc: {train_acc}, val loss: {val_loss}, val acc: {val_acc}")
    

        scheduler.step()

        if (epoch+1) % 10 == 0:
            torch.save(model.state_dict(), f'save_states/CNNmodel{experimentNum}Epoch{epoch+1}.pt')  # Save the trained model\

    torch.save(model.state_dict(), f'save_states/CNNmodel{experimentNum}Epoch{epoch+1}.pt')  # Save the trained model\

    plt.plot(np.arange(num_epochs), list(train_losses))
    plt.xlabel('Epochs')
    plt.ylabel('Loss')
    plt.title('Loss over time')
    plt.show()

    if test_loop:
        model.eval()
        running_acc = 0.0
        for images, labels in tqdm(test_loader, desc="testing"):
            images = images.to(device)
            labels = labels.to(device)
            outputs = model(images)
            running_acc += accuracy(outputs, images)
        
        test_loss = running_acc / len(test_loader.dataset) * 32 * 100
        print(f"TEST LOSS: {test_loss}")

if __name__ == '__main__':
    main(num_epochs = 100, 
         experimentNum = 14,
         use_model = CNN14(),
         use_dataset_train = new_train_dataset,
         use_dataset_val = val_dataset,
         use_dataset_test = test_dataset,
         num_classes = 81,
         loadFromSaved = None,
         test_loop = False)
    


# Experiment 1: Test, loss at around 0.3, did not print accuracy / 15 epochs
# Experiment 2: Learning rate probably too slow, loss was arund 0.1 and only 3 percent acc, loaded experiment 1 and had 7 more epochs
# Experiment 3: Load from experiment 2 and change LR from 0.001 to 0.01. Realized architecture is wrong, now remove softmax and adjust some in/out feature sizes

# Experiment 4: Start over at zero, didn't save anything - LR too high (according to graph in Spis Notes 3.6)
# Experiment 5: Change LR to 0.005 and use num_workers = 8, added mpl to be able to check learning rate, this one took very long time to start up 

# Experiment 6: Change LR to 0.003, num_workers = 5, step scheduler added with step_size = 10 and gamma = 0.8
# Epoch 100/100 - Train loss: 0.009682740432858926 train acc: 0.031166922301054, val loss: 0.15009788159322832, val acc: 0.03110380657017231 ....................

# Experiment 7: TRIED Mnist dataset, LR too high, acc still around 3 percent, might really be *32 issue
# Experiment 7: LR to 0.001, DONT softmax or relu final fc layer
# Experiment 8: output classes now 10 # THIS WORKS FOR DRAW.PY. Multiply acc by 32 now

# Experiment 9: 20 epochs 98 acc, LR 0.003
# Experiment 10: 30 epochs, LR 0.004, peak accuracy at 98   

# TESTED MODEL_9_E_20 with drawpy and got reasonable results. Seems to overfit when characters are written in messy handwriting

# Experiment 11: Tried VamsiNN, worked with 98.8 val acc on 15th epoch
# Experiment 12: Try a pad=0, stride all equals 1, only 2 fc layers, batch_norm FC_1 for 98 epochs, LR 0.0035
#                E25 seems pretty overfitted (under?), works better with pen size 45, values also all negative 
#                E50 has positive values with pen size 45 and drawing fill up the screen
#                E75 is AWFUL, so is E98, keep going with E50 and change pen sizes

# Experiment 13: Get rid of gray noise, went back to three FC layers, with softmax is confirmed bad, LR 0.003, acc at 99.2 E30
# Experiment 14: Same as 13 but adjusted LR to 0.002 and add dropout for FC1 and FC2

'''PS C:\Users\edmun\VSC_DIRS\Dynamic-Digit-Recognition> & C:/Users/edmun/anaconda3/envs/py11/python.exe c:/Users/edmun/VSC_DIRS/Dynamic-Digit-Recognition/train.py
Epoch 1: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:38<00:00, 85.88it/s]
Epoch 1: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:30<00:00, 30.31it/s]
Epoch 1/100 - Train loss: 0.5719377620087364 train acc: 84.1936264038086, val loss: 0.2180910900813775, val acc: 93.39259338378906
Epoch 2: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:27<00:00, 96.74it/s]
Epoch 2: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:30<00:00, 30.20it/s]
Epoch 2/100 - Train loss: 0.32881297753722244 train acc: 90.52864837646484, val loss: 0.1732080069589721, val acc: 94.63899993896484
Epoch 3: training loop: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:24<00:00, 99.05it/s]
Epoch 3: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 51.02it/s]
Epoch 3/100 - Train loss: 0.26554430935240614 train acc: 92.1794204711914, val loss: 0.15876085885341637, val acc: 95.13689422607422
Epoch 4: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.31it/s]
Epoch 4: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.88it/s]
Epoch 4/100 - Train loss: 0.2311839438727932 train acc: 93.11285400390625, val loss: 0.13159733998073794, val acc: 96.0257568359375
Epoch 5: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.22it/s]
Epoch 5: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.93it/s]
Epoch 5/100 - Train loss: 0.2079510039015633 train acc: 93.74739837646484, val loss: 0.12196067781735632, val acc: 96.36993408203125
Epoch 6: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.20it/s]
Epoch 6: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.83it/s]
Epoch 6/100 - Train loss: 0.19054275627005324 train acc: 94.29840087890625, val loss: 0.11367363628440194, val acc: 96.48020935058594
Epoch 7: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.24it/s]
Epoch 7: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.87it/s]
Epoch 7/100 - Train loss: 0.17886007353061484 train acc: 94.64259338378906, val loss: 0.10644527348739964, val acc: 96.714111328125
Epoch 8: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.54it/s]
Epoch 8: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.50it/s]
Epoch 8/100 - Train loss: 0.16728510289799706 train acc: 94.95856475830078, val loss: 0.0996428203234621, val acc: 96.92129516601562
Epoch 9: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.41it/s]
Epoch 9: val loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.68it/s]
Epoch 9/100 - Train loss: 0.1597238798018662 train acc: 95.2195816040039, val loss: 0.09473988639788951, val acc: 97.10174560546875
Epoch 10: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.34it/s]
Epoch 10: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.81it/s]
Epoch 10/100 - Train loss: 0.15222943587346255 train acc: 95.45721435546875, val loss: 0.09162272596627838, val acc: 97.28553009033203
Epoch 11: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.29it/s]
Epoch 11: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.88it/s]
Epoch 11/100 - Train loss: 0.13120003504832203 train acc: 96.01155853271484, val loss: 0.07721972896582487, val acc: 97.56956481933594
Epoch 12: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.45it/s]
Epoch 12: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.77it/s]
Epoch 12/100 - Train loss: 0.12326701457852644 train acc: 96.27703094482422, val loss: 0.07892078541561315, val acc: 97.62413787841797
Epoch 13: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.47it/s] 
Epoch 13: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.39it/s] 
Epoch 13/100 - Train loss: 0.11705805394414484 train acc: 96.47047424316406, val loss: 0.07508868053398951, val acc: 97.89814758300781
Epoch 14: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:21<00:00, 102.79it/s] 
Epoch 14: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.68it/s] 
Epoch 14/100 - Train loss: 0.11381921110113506 train acc: 96.63755798339844, val loss: 0.07240537495522341, val acc: 98.05186462402344
Epoch 15: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.56it/s] 
Epoch 15: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.58it/s] 
Epoch 15/100 - Train loss: 0.10970522888193326 train acc: 96.71256256103516, val loss: 0.06671929908552551, val acc: 98.07859802246094
Epoch 16: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.50it/s] 
Epoch 16: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.45it/s] 
Epoch 16/100 - Train loss: 0.1037923006585002 train acc: 96.9082260131836, val loss: 0.06628311610827368, val acc: 98.28911590576172
Epoch 17: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.32it/s] 
Epoch 17: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.58it/s] 
Epoch 17/100 - Train loss: 0.10169816521701475 train acc: 97.01405334472656, val loss: 0.06431324085769585, val acc: 98.36930847167969
Epoch 18: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.36it/s] 
Epoch 18: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.84it/s] 
Epoch 18/100 - Train loss: 0.10009591248428394 train acc: 97.10539245605469, val loss: 0.05984223171657287, val acc: 98.3993911743164
Epoch 19: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.33it/s] 
Epoch 19: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.55it/s] 
Epoch 19/100 - Train loss: 0.09796669353144377 train acc: 97.18521881103516, val loss: 0.056908836384874165, val acc: 98.51968383789062
Epoch 20: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.26it/s] 
Epoch 20: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.94it/s]
Epoch 20/100 - Train loss: 0.094523255336926 train acc: 97.3147964477539, val loss: 0.05743302439422334, val acc: 98.49295043945312
Epoch 21: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.19it/s]
Epoch 21: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.73it/s] 
Epoch 21/100 - Train loss: 0.08376406275695596 train acc: 97.62408447265625, val loss: 0.04948115342741517, val acc: 98.71683502197266
Epoch 22: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.43it/s] 
Epoch 22: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.46it/s] 
Epoch 22/100 - Train loss: 0.07781850359625861 train acc: 97.75997924804688, val loss: 0.05464395173039705, val acc: 98.79703521728516
Epoch 23: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.30it/s] 
Epoch 23: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.75it/s] 
Epoch 23/100 - Train loss: 0.07726191768291436 train acc: 97.79450988769531, val loss: 0.04734886364542087, val acc: 98.84716033935547
Epoch 24: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.10it/s] 
Epoch 24: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.86it/s] 
Epoch 24/100 - Train loss: 0.07333050675726621 train acc: 97.95008087158203, val loss: 0.05058806348075639, val acc: 98.84381866455078
Epoch 25: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.28it/s] 
Epoch 25: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.93it/s] 
Epoch 25/100 - Train loss: 0.07159619568250758 train acc: 97.94302368164062, val loss: 0.0451012454311862, val acc: 98.94740295410156
Epoch 26: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.50it/s] 
Epoch 26: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.85it/s] 
Epoch 26/100 - Train loss: 0.07072230142756311 train acc: 97.97644805908203, val loss: 0.048129220507780686, val acc: 98.96076965332031
Epoch 27: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.28it/s] 
Epoch 27: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 51.07it/s] 
Epoch 27/100 - Train loss: 0.0700243035932442 train acc: 98.01097869873047, val loss: 0.04711568134020231, val acc: 99.04096984863281
Epoch 28: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.44it/s] 
Epoch 28: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.68it/s] 
Epoch 28/100 - Train loss: 0.06768829123810977 train acc: 98.10194396972656, val loss: 0.04203581695630086, val acc: 99.04096984863281
Epoch 29: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.30it/s] 
Epoch 29: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 51.09it/s] 
Epoch 29/100 - Train loss: 0.0673184260177427 train acc: 98.11568450927734, val loss: 0.045562379307282595, val acc: 99.071044921875
Epoch 30: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:21<00:00, 102.66it/s] 
Epoch 30: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 51.19it/s] 
Epoch 30/100 - Train loss: 0.0679543228709086 train acc: 98.1260757446289, val loss: 0.04434554467037755, val acc: 99.07438659667969
Epoch 31: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:21<00:00, 102.88it/s]
Epoch 31: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.88it/s] 
Epoch 31/100 - Train loss: 0.059684505715813414 train acc: 98.35404968261719, val loss: 0.044015213544264506, val acc: 99.13118743896484
Epoch 32: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:21<00:00, 103.01it/s] 
Epoch 32: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.96it/s] 
Epoch 32/100 - Train loss: 0.0559199381724898 train acc: 98.4323959350586, val loss: 0.040143149668118897, val acc: 99.19133758544922
Epoch 33: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.23it/s] 
Epoch 33: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.85it/s] 
Epoch 33/100 - Train loss: 0.05556442014701518 train acc: 98.40715026855469, val loss: 0.04121834218457655, val acc: 99.22809600830078
Epoch 34: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.36it/s] 
Epoch 34: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.66it/s] 
Epoch 34/100 - Train loss: 0.0545840144794716 train acc: 98.51964569091797, val loss: 0.04415129738629064, val acc: 99.23812103271484
Epoch 35: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.38it/s] 
Epoch 35: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 51.00it/s] 
Epoch 35/100 - Train loss: 0.05375826050055269 train acc: 98.52484130859375, val loss: 0.04217345364848706, val acc: 99.23143768310547
Epoch 36: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:25<00:00, 98.43it/s] 
Epoch 36: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.64it/s] 
Epoch 36/100 - Train loss: 0.0535657533606477 train acc: 98.52781677246094, val loss: 0.043560683932832335, val acc: 99.25817108154297
Epoch 37: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:29<00:00, 93.65it/s] 
Epoch 37: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:19<00:00, 47.97it/s] 
Epoch 37/100 - Train loss: 0.05166603357228727 train acc: 98.57756805419922, val loss: 0.03699275352921677, val acc: 99.28156280517578
Epoch 38: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:21<00:00, 102.66it/s] 
Epoch 38: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.62it/s] 
Epoch 38/100 - Train loss: 0.05176548029515261 train acc: 98.56568908691406, val loss: 0.04088853844534476, val acc: 99.26819610595703
Epoch 39: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:21<00:00, 102.84it/s] 
Epoch 39: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.61it/s] 
Epoch 39/100 - Train loss: 0.051282511986953556 train acc: 98.59130859375, val loss: 0.04398013630095877, val acc: 99.2782211303711
Epoch 40: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.34it/s] 
Epoch 40: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.51it/s] 
Epoch 40/100 - Train loss: 0.05301236637246026 train acc: 98.55900573730469, val loss: 0.04234149778314402, val acc: 99.2481460571289
Epoch 41: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.19it/s]
Epoch 41: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.85it/s] 
Epoch 41/100 - Train loss: 0.04766687553277212 train acc: 98.69898223876953, val loss: 0.041032591429587026, val acc: 99.33837127685547
Epoch 42: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.47it/s] 
Epoch 42: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.75it/s] 
Epoch 42/100 - Train loss: 0.04416234097616766 train acc: 98.77584075927734, val loss: 0.03997425019728147, val acc: 99.33502960205078
Epoch 43: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.29it/s] 
Epoch 43: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.42it/s] 
Epoch 43/100 - Train loss: 0.04257004644764373 train acc: 98.80258178710938, val loss: 0.04264278698770255, val acc: 99.35173034667969
Epoch 44: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 101.95it/s] 
Epoch 44: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.85it/s] 
Epoch 44/100 - Train loss: 0.042227674989492446 train acc: 98.82856750488281, val loss: 0.04012327375619649, val acc: 99.3283462524414
Epoch 45: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.40it/s] 
Epoch 45: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.95it/s] 
Epoch 45/100 - Train loss: 0.0417719573959254 train acc: 98.8319091796875, val loss: 0.038441116920752964, val acc: 99.26151275634766
Epoch 46: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.28it/s] 
Epoch 46: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.90it/s] 
Epoch 46/100 - Train loss: 0.0404948332350045 train acc: 98.8601303100586, val loss: 0.03835769695980261, val acc: 99.3049545288086
Epoch 47: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.59it/s] 
Epoch 47: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.63it/s]
Epoch 47/100 - Train loss: 0.04083560763280753 train acc: 98.8423080444336, val loss: 0.03983509542201826, val acc: 99.3584213256836
Epoch 48: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.52it/s] 
Epoch 48: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.84it/s] 
Epoch 48/100 - Train loss: 0.0413214274434575 train acc: 98.84935760498047, val loss: 0.03572933121420715, val acc: 99.3550796508789
Epoch 49: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:21<00:00, 102.68it/s] 
Epoch 49: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.78it/s] 
Epoch 49/100 - Train loss: 0.040494498967851365 train acc: 98.88685607910156, val loss: 0.040193810758158435, val acc: 99.34505462646484
Epoch 50: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:21<00:00, 102.73it/s] 
Epoch 50: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.99it/s] 
Epoch 50/100 - Train loss: 0.0410731232695955 train acc: 98.87200927734375, val loss: 0.03777784532870936, val acc: 99.4118881225586
Epoch 51: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.11it/s] 
Epoch 51: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.87it/s] 
Epoch 51/100 - Train loss: 0.037421207624956834 train acc: 98.96705627441406, val loss: 0.0395249177491259, val acc: 99.42859649658203
Epoch 52: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.34it/s] 
Epoch 52: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.36it/s] 
Epoch 52/100 - Train loss: 0.036339490790620696 train acc: 98.99267578125, val loss: 0.04403213487594837, val acc: 99.37178802490234
Epoch 53: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.27it/s] 
Epoch 53: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.76it/s] 
Epoch 53/100 - Train loss: 0.035224973860227195 train acc: 99.01532745361328, val loss: 0.04069070347996608, val acc: 99.42524719238281
Epoch 54: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.26it/s] 
Epoch 54: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.88it/s] 
Epoch 54/100 - Train loss: 0.03433935255951253 train acc: 99.0442886352539, val loss: 0.03917593305157421, val acc: 99.43193054199219
Epoch 55: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.09it/s] 
Epoch 55: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 51.01it/s] 
Epoch 55/100 - Train loss: 0.034449290950410605 train acc: 99.02721405029297, val loss: 0.03914296459756086, val acc: 99.45866394042969
Epoch 56: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.40it/s] 
Epoch 56: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.88it/s] 
Epoch 56/100 - Train loss: 0.034231060183549274 train acc: 99.03277587890625, val loss: 0.04028749379486841, val acc: 99.43527221679688
Epoch 57: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.21it/s] 
Epoch 57: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.96it/s] 
Epoch 57/100 - Train loss: 0.03343681986403008 train acc: 99.0531997680664, val loss: 0.04110067053549542, val acc: 99.42524719238281
Epoch 58: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:21<00:00, 102.75it/s] 
Epoch 58: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.94it/s] 
Epoch 58/100 - Train loss: 0.033519129525006554 train acc: 99.07621765136719, val loss: 0.03810354007644238, val acc: 99.41522216796875
Epoch 59: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:21<00:00, 102.77it/s] 
Epoch 59: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.69it/s] 
Epoch 59/100 - Train loss: 0.03392982281462078 train acc: 99.06062316894531, val loss: 0.03866018093095599, val acc: 99.38848876953125
Epoch 60: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.08it/s] 
Epoch 60: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.78it/s] 
Epoch 60/100 - Train loss: 0.03388403745169413 train acc: 99.0739974975586, val loss: 0.038690350314613466, val acc: 99.44530487060547
Epoch 61: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:23<00:00, 101.26it/s]
Epoch 61: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 49.46it/s] 
Epoch 61/100 - Train loss: 0.030397365657138947 train acc: 99.16050720214844, val loss: 0.03879313766838036, val acc: 99.4820556640625
Epoch 62: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.35it/s] 
Epoch 62: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.79it/s] 
Epoch 62/100 - Train loss: 0.029374519397005038 train acc: 99.17684173583984, val loss: 0.0379964283314172, val acc: 99.46868896484375
Epoch 63: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.50it/s] 
Epoch 63: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.44it/s] 
Epoch 63/100 - Train loss: 0.030046227142810588 train acc: 99.16087341308594, val loss: 0.03660931738292472, val acc: 99.41857147216797
Epoch 64: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:21<00:00, 102.74it/s] 
Epoch 64: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.87it/s] 
Epoch 64/100 - Train loss: 0.02908508491532174 train acc: 99.17572784423828, val loss: 0.03738751013814629, val acc: 99.4386215209961
Epoch 65: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:23<00:00, 101.28it/s] 
Epoch 65: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.78it/s] 
Epoch 65/100 - Train loss: 0.029405775809487604 train acc: 99.18537902832031, val loss: 0.040061250665022065, val acc: 99.45866394042969
Epoch 66: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 101.93it/s] 
Epoch 66: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.62it/s] 
Epoch 66/100 - Train loss: 0.028549100613895248 train acc: 99.21173858642578, val loss: 0.04305846176637542, val acc: 99.52549743652344
Epoch 67: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.09it/s] 
Epoch 67: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.65it/s] 
Epoch 67/100 - Train loss: 0.027502563338934083 train acc: 99.21916961669922, val loss: 0.03861735486323436, val acc: 99.47203063964844
Epoch 68: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:23<00:00, 100.65it/s] 
Epoch 68: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.53it/s]
Epoch 68/100 - Train loss: 0.027630489439308084 train acc: 99.20951080322266, val loss: 0.04771968535262734, val acc: 99.4653549194336
Epoch 69: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:23<00:00, 100.70it/s] 
Epoch 69: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:21<00:00, 42.81it/s] 
Epoch 69/100 - Train loss: 0.02822531152930453 train acc: 99.20320129394531, val loss: 0.04462540893082145, val acc: 99.50544738769531
Epoch 70: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.28it/s] 
Epoch 70: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.62it/s] 
Epoch 70/100 - Train loss: 0.027478807056100108 train acc: 99.23661804199219, val loss: 0.04391599614337145, val acc: 99.5355224609375
Epoch 71: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:23<00:00, 100.79it/s]
Epoch 71: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:21<00:00, 44.56it/s] 
Epoch 71/100 - Train loss: 0.026015350065105965 train acc: 99.26112365722656, val loss: 0.04085606127444169, val acc: 99.47203063964844
Epoch 72: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:28<00:00, 94.83it/s] 
Epoch 72: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:20<00:00, 46.43it/s] 
Epoch 72/100 - Train loss: 0.024591485082545692 train acc: 99.29045104980469, val loss: 0.041395791012994045, val acc: 99.49542236328125
Epoch 73: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:31<00:00, 92.30it/s] 
Epoch 73: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:20<00:00, 46.60it/s]
Epoch 73/100 - Train loss: 0.024724585819211102 train acc: 99.29305267333984, val loss: 0.04015522592282296, val acc: 99.46868896484375
Epoch 74: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:24<00:00, 99.32it/s] 
Epoch 74: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.71it/s] 
Epoch 74/100 - Train loss: 0.024444801249614068 train acc: 99.30047607421875, val loss: 0.04175260200331789, val acc: 99.52883911132812
Epoch 75: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:25<00:00, 98.25it/s] 
Epoch 75: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.65it/s] 
Epoch 75/100 - Train loss: 0.024683022619909626 train acc: 99.31087493896484, val loss: 0.04209478473527874, val acc: 99.4920883178711
Epoch 76: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.52it/s] 
Epoch 76: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.83it/s] 
Epoch 76/100 - Train loss: 0.02572962836405352 train acc: 99.28748321533203, val loss: 0.04223714107387434, val acc: 99.5355224609375
Epoch 77: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:24<00:00, 99.93it/s] 
Epoch 77: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:27<00:00, 33.65it/s] 
Epoch 77/100 - Train loss: 0.022849122832803697 train acc: 99.3383560180664, val loss: 0.042043847259406006, val acc: 99.51547241210938
Epoch 78: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:23<00:00, 100.34it/s] 
Epoch 78: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.86it/s] 
Epoch 78/100 - Train loss: 0.024247286666150482 train acc: 99.30567932128906, val loss: 0.0409384018812928, val acc: 99.48539733886719
Epoch 79: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.58it/s] 
Epoch 79: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.61it/s] 
Epoch 79/100 - Train loss: 0.02339477832351686 train acc: 99.33426666259766, val loss: 0.03778116026954685, val acc: 99.49542236328125
Epoch 80: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:24<00:00, 99.69it/s] 
Epoch 80: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:27<00:00, 33.97it/s] 
Epoch 80/100 - Train loss: 0.02321018879024465 train acc: 99.34095001220703, val loss: 0.0399133750618505, val acc: 99.49542236328125
Epoch 81: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:24<00:00, 100.13it/s]
Epoch 81: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:19<00:00, 47.67it/s] 
Epoch 81/100 - Train loss: 0.022717684119463413 train acc: 99.35691833496094, val loss: 0.04158448573042943, val acc: 99.55223083496094
Epoch 82: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.25it/s] 
Epoch 82: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.52it/s] 
Epoch 82/100 - Train loss: 0.022586818109019267 train acc: 99.36285400390625, val loss: 0.04007514460263432, val acc: 99.55557250976562
Epoch 83: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.12it/s] 
Epoch 83: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.73it/s] 
Epoch 83/100 - Train loss: 0.021504787708376435 train acc: 99.37659454345703, val loss: 0.04175482374691978, val acc: 99.52215576171875
Epoch 84: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.59it/s] 
Epoch 84: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 51.12it/s] 
Epoch 84/100 - Train loss: 0.021459420774559125 train acc: 99.37808227539062, val loss: 0.04317630514636616, val acc: 99.55223083496094
Epoch 85: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:23<00:00, 101.24it/s] 
Epoch 85: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.47it/s] 
Epoch 85/100 - Train loss: 0.0215853200839466 train acc: 99.39590454101562, val loss: 0.04237181845566216, val acc: 99.55223083496094
Epoch 86: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:24<00:00, 99.67it/s] 
Epoch 86: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:28<00:00, 33.01it/s] 
Epoch 86/100 - Train loss: 0.020435846529210915 train acc: 99.41595458984375, val loss: 0.0388023412623602, val acc: 99.51881408691406
Epoch 87: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.14it/s] 
Epoch 87: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.64it/s] 
Epoch 87/100 - Train loss: 0.021400148514571588 train acc: 99.40815734863281, val loss: 0.03986648163810453, val acc: 99.51881408691406
Epoch 88: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:25<00:00, 98.61it/s] 
Epoch 88: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:35<00:00, 26.36it/s] 
Epoch 88/100 - Train loss: 0.021480395124556642 train acc: 99.38365173339844, val loss: 0.03803208498450586, val acc: 99.57562255859375
Epoch 89: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:29<00:00, 93.98it/s] 
Epoch 89: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:25<00:00, 37.29it/s] 
Epoch 89/100 - Train loss: 0.020259107324144893 train acc: 99.41446685791016, val loss: 0.04134826329076329, val acc: 99.51213073730469
Epoch 90: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.56it/s] 
Epoch 90: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.82it/s] 
Epoch 90/100 - Train loss: 0.02128290325906648 train acc: 99.40704345703125, val loss: 0.036316592856741284, val acc: 99.56559753417969
Epoch 91: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:24<00:00, 99.76it/s]
Epoch 91: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.74it/s] 
Epoch 91/100 - Train loss: 0.019857135750361174 train acc: 99.42709350585938, val loss: 0.04066696758355061, val acc: 99.60569763183594
Epoch 92: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:24<00:00, 99.83it/s] 
Epoch 92: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.60it/s] 
Epoch 92/100 - Train loss: 0.018709848548147015 train acc: 99.44342803955078, val loss: 0.03875259317504338, val acc: 99.53886413574219
Epoch 93: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.30it/s] 
Epoch 93: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.68it/s] 
Epoch 93/100 - Train loss: 0.019221051786558484 train acc: 99.45753479003906, val loss: 0.04141948070935131, val acc: 99.562255859375
Epoch 94: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:24<00:00, 99.25it/s] 
Epoch 94: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:20<00:00, 45.52it/s] 
Epoch 94/100 - Train loss: 0.020471226181103898 train acc: 99.43340301513672, val loss: 0.03799918441215341, val acc: 99.55223083496094
Epoch 95: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:24<00:00, 99.72it/s] 
Epoch 95: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:24<00:00, 38.07it/s] 
Epoch 95/100 - Train loss: 0.019592572865640475 train acc: 99.4308090209961, val loss: 0.03627668512294058, val acc: 99.562255859375
Epoch 96: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 101.44it/s] 
Epoch 96: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.85it/s] 
Epoch 96/100 - Train loss: 0.01808729171624404 train acc: 99.46904754638672, val loss: 0.037586026476991295, val acc: 99.55557250976562
Epoch 97: training loop: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:25<00:00, 98.40it/s] 
Epoch 97: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:28<00:00, 32.94it/s] 
Epoch 97/100 - Train loss: 0.018298154502317095 train acc: 99.46013641357422, val loss: 0.040426887724774714, val acc: 99.60569763183594
Epoch 98: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:23<00:00, 100.46it/s] 
Epoch 98: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.77it/s]
Epoch 98/100 - Train loss: 0.01810923629882065 train acc: 99.46719360351562, val loss: 0.03598339015611625, val acc: 99.57228088378906
Epoch 99: training loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:22<00:00, 102.44it/s] 
Epoch 99: val loop: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.73it/s] 
Epoch 99/100 - Train loss: 0.018762781285662593 train acc: 99.46571350097656, val loss: 0.041154526266422034, val acc: 99.56893920898438
Epoch 100: training loop: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 8417/8417 [01:21<00:00, 102.69it/s] 
Epoch 100: val loop: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 936/936 [00:18<00:00, 50.52it/s] 
Epoch 100/100 - Train loss: 0.01728464055879278 train acc: 99.4813003540039, val loss: 0.04064032636827748, val acc: 99.59233093261719
'''